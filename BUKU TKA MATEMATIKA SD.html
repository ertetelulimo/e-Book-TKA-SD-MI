<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tes Akademik SD</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#ff0000; }
.card { max-width:950px; margin:0 auto; padding:25px; border-radius:12px; background:#ff0000; color:#fff; position:relative; }
input, select, button { width:100%; padding:12px; margin:6px 0; border-radius:8px; border:1px solid #ccc; font-size:1rem; }
button { font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { opacity:0.9; }
.hidden { display:none; }
.option-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:15px; }
.option { padding:10px; border:2px solid #fff; border-radius:8px; background:#fff; color:#000; cursor:pointer; font-weight:bold; }
.option.selected { background:#06d6a0; border-color:#0077b6; color:#000; }
.scoreBox { font-size:1.2rem; margin-top:20px; text-align:center; background:#fff; color:#ff4500; padding:10px; border-radius:8px; }
.pembahasan { background:#fff; color:#000; padding:8px; border-radius:6px; margin:5px 0; }
#btnBackSiswa, #btnBackSoal { background:#0000ff; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; margin-bottom:10px; }
#btnKirimJawaban, #btnLogoutSiswa { background:#000; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; }
.adminBox { display:none; background:#fff; color:#000; padding:15px; border-radius:8px; margin-top:15px; }
.adminBox table { width:100%; border-collapse:collapse; }
.adminBox th, .adminBox td { border:1px solid #000; padding:5px; text-align:center; }
.adminBox th { background:#ffcccc; }
</style>
</head>
<body>
<div class="card">
  <h2>Masuk Tes Akademik SD</h2>

  <!-- LOGIN -->
  <div id="loginBox">
    <input id="email" placeholder="Masukkan email">
    <input id="password" type="password" placeholder="Masukkan password">
    <button id="btnLogin">Masuk</button>
    <p id="msg"></p>
  </div>

  <!-- SISWA -->
  <div id="siswaBox" class="hidden">
    <button id="btnBackSiswa">‚¨Ö Kembali</button>
    <h3>Halo, <span id="namaSiswa"></span> üëã</h3>
    <button id="btnKirimEmail">Kirim Email ke Admin untuk Verifikasi</button>
    <div id="pilihPelajaranBox" class="hidden">
      <label for="subPelajaran">Pilih Pelajaran:</label>
      <select id="subPelajaran">
        <option value="">-- Pilih Pelajaran --</option>
        <optgroup label="TKA (Wajib)">
          <option value="bahasa_indonesia">Bahasa Indonesia</option>
          <option value="matematika">Matematika</option>
        </optgroup>
        <optgroup label="Sub Mapel TKA (Pilihan)">
          <option value="ipa">IPA</option>
          <option value="ppkn">PPKn</option>
          <option value="sbdp">SBdP</option>
          <option value="bahasa_inggris">Bahasa Inggris</option>
          <option value="pjok">PJOK</option>
        </optgroup>
      </select>
      <button id="btnMulaiTes" disabled>Mulai Tes</button>
    </div>

    <div id="soalBox" class="hidden">
      <button id="btnBackSoal">‚¨Ö Kembali</button>
      <h3>üìò Lembar Soal</h3>
      <div id="soalContainer"></div>
      <button id="btnKirimJawaban">Kirim Jawaban</button>
      <div id="hasilTes" class="hidden"></div>
    </div>
    <button id="btnLogoutSiswa">Logout</button>
  </div>

  <!-- ADMIN -->
  <div id="adminBox" class="adminBox">
    <h3>Panel Admin üßë‚Äçüíº</h3>
    <table id="tabelVerifikasi">
      <thead>
        <tr><th>Email</th><th>Status</th><th>Aksi</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="btnLogoutAdmin">Logout Admin</button>
  </div>

</div>

<script>
const USERS = {
  "admin@gmail.com":"777",
  "ani@gmail.com":"ani123",
  "budi@gmail.com":"budi123",
  "citra@gmail.com":"citra123"
};

let VERIFIKASI = JSON.parse(localStorage.getItem('verifikasiData')||'{}');
let LOGIN_DEVICES = JSON.parse(localStorage.getItem('loginDevices')||'{}');

// ===== Soal Pilihan A‚ÄìD =====
const SOAL = {
  bahasa_indonesia:[
    {soal:"1Ô∏è‚É£ Pilih kata baku", opsi:["Apotek","Apotik","-","-"], jawaban:0, pembahasan:"Jawaban benar: Apotek"},
    {soal:"2Ô∏è‚É£ 'Dia sedang ... buku'", opsi:["membaca","membace","-","-"], jawaban:0, pembahasan:"Jawaban benar: membaca"}
  ],
  matematika:[
    {soal:"1Ô∏è‚É£ 7 + 8 √ó 2 = ?", opsi:["22","23","24","30"], jawaban:1, pembahasan:"Jawaban: 23"},
    {soal:"2Ô∏è‚É£ Pecahan senilai 1/2", opsi:["2/4","3/6","1/3","1/4"], jawaban:0, pembahasan:"2/4 = 1/2"}
  ],
  ipa:[
    {soal:"1Ô∏è‚É£ Planet terdekat Matahari", opsi:["Venus","Merkurius","Bumi","Mars"], jawaban:1, pembahasan:"Merkurius"},
    {soal:"2Ô∏è‚É£ Air menguap karena ...", opsi:["Pemanasan","Pendinginan","Pencairan","Pembekuan"], jawaban:0, pembahasan:"Pemanasan"}
  ],
  ppkn:[
    {soal:"1Ô∏è‚É£ Pancasila berapa sila?", opsi:["4","5","6","3"], jawaban:1, pembahasan:"5"},
    {soal:"2Ô∏è‚É£ Sila pertama?", opsi:["Ketuhanan","Kemanusiaan","Persatuan","Keadilan"], jawaban:0, pembahasan:"Ketuhanan"}
  ],
  sbdp:[
    {soal:"1Ô∏è‚É£ Alat musik dipukul?", opsi:["Kendang","Gamelan","Suling","Seruling"], jawaban:0, pembahasan:"Kendang"},
    {soal:"2Ô∏è‚É£ Tari tradisional Bali?", opsi:["Bali","Jawa","Sumatra","Papua"], jawaban:0, pembahasan:"Bali"}
  ],
  bahasa_inggris:[
    {soal:"1Ô∏è‚É£ English of 'apel'?", opsi:["Apple","Orange","Grape","Banana"], jawaban:0, pembahasan:"Apple"},
    {soal:"2Ô∏è‚É£ She ... to school yesterday", opsi:["went","goes","gone","goed"], jawaban:0, pembahasan:"went"}
  ],
  pjok:[
    {soal:"1Ô∏è‚É£ Senam lantai?", opsi:["Senam","Atletik","Renang","Sepakbola"], jawaban:0, pembahasan:"Senam"},
    {soal:"2Ô∏è‚É£ Lari cepat?", opsi:["Sprint","Jogging","Lari santai","Maraton"], jawaban:0, pembahasan:"Sprint"}
  ]
};

// ===== Device =====
function getDeviceID(){ let id=localStorage.getItem('deviceID'); if(!id){id='dev-'+Math.random().toString(36).substr(2,9); localStorage.setItem('deviceID',id);} return id; }

// ===== LOGIN =====
document.getElementById('btnLogin').addEventListener('click',()=>{
  const email=document.getElementById('email').value.trim().toLowerCase();
  const pass=document.getElementById('password').value.trim();
  const msg=document.getElementById('msg'); msg.textContent="";
  if(!USERS[email] || USERS[email]!==pass){ msg.textContent="‚ùå Email atau password salah"; return; }

  if(email==="admin@gmail.com"){
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('adminBox').style.display="block";
    tampilTabelAdmin();
    return;
  }

  localStorage.setItem('loginEmail',email);
  document.getElementById('loginBox').classList.add('hidden');
  document.getElementById('siswaBox').classList.remove('hidden');
  document.getElementById('namaSiswa').textContent=email;

  const deviceID=getDeviceID();
  if(!LOGIN_DEVICES[email]) LOGIN_DEVICES[email]=[];
  if(!LOGIN_DEVICES[email].includes(deviceID)) LOGIN_DEVICES[email].push(deviceID);
  localStorage.setItem('loginDevices',JSON.stringify(LOGIN_DEVICES));
  cekStatus(email);
});

// ===== Logout & Back =====
document.getElementById('btnLogoutSiswa').addEventListener('click',()=>{ localStorage.removeItem('loginEmail'); document.getElementById('siswaBox').classList.add('hidden'); document.getElementById('loginBox').classList.remove('hidden'); });
document.getElementById('btnBackSiswa').addEventListener('click',()=>{ localStorage.removeItem('loginEmail'); document.getElementById('siswaBox').classList.add('hidden'); document.getElementById('loginBox').classList.remove('hidden'); });
document.getElementById('btnBackSoal').addEventListener('click',()=>{ document.getElementById('soalBox').classList.add('hidden'); document.getElementById('pilihPelajaranBox').classList.remove('hidden'); document.getElementById('hasilTes').classList.add('hidden'); });
document.getElementById('btnLogoutAdmin').addEventListener('click',()=>{ document.getElementById('adminBox').style.display="none"; document.getElementById('loginBox').classList.remove('hidden'); });

// ===== Kirim email =====
document.getElementById('btnKirimEmail').addEventListener('click',()=>{
  const email=localStorage.getItem('loginEmail');
  VERIFIKASI[email]={status:"Menunggu",verifiedAt:null};
  localStorage.setItem('verifikasiData',JSON.stringify(VERIFIKASI));
  alert("üì® Permintaan verifikasi dikirim ke admin.");
  cekStatus(email);
});

// ===== Cek status =====
function cekStatus(email){
  const pilihBox=document.getElementById('pilihPelajaranBox');
  const btnEmail=document.getElementById('btnKirimEmail');
  const data=VERIFIKASI[email];
  if(!data || data.status==="Menunggu"){ pilihBox.classList.add('hidden'); btnEmail.style.display=data?"none":"block"; return; }
  if(data.status==="Disetujui"){ pilihBox.classList.remove('hidden'); btnEmail.style.display="none"; }
}

// ===== Mulai Tes =====
document.getElementById('subPelajaran').addEventListener('change',e=>{ document.getElementById('btnMulaiTes').disabled=e.target.value==="" });
document.getElementById('btnMulaiTes').addEventListener('click',()=>{
  const pelajaran=document.getElementById('subPelajaran').value;
  if(!pelajaran) return alert("Pilih pelajaran!");
  document.getElementById('soalBox').classList.remove('hidden');
  tampilSoal(pelajaran);
});

// ===== Tampil Soal =====
function tampilSoal(pelajaran){
  const container=document.getElementById('soalContainer'); container.innerHTML="";
  SOAL[pelajaran].forEach((s,i)=>{
    let html=`<p>${s.soal}</p><div class="option-grid">`;
    s.opsi.forEach((o,j)=>{
      const abcd = String.fromCharCode(65+j);
      html+=`<div class="option" data-name="${i}" data-value="${j}">${abcd}. ${o}</div>`;
    });
    html+="</div>";
    container.innerHTML+=html;
  });
  document.querySelectorAll('.option').forEach(opt=>{
    opt.addEventListener('click', ()=>{
      const name=opt.dataset.name;
      document.querySelectorAll(`.option[data-name="${name}"]`).forEach(el=>el.classList.remove('selected'));
      opt.classList.add('selected');
    });
  });
  document.getElementById('btnKirimJawaban').onclick=()=>{
    let benar=0, hasil="";
    SOAL[pelajaran].forEach((s,i)=>{
      const pilih=document.querySelector(`.option[data-name="${i}"].selected`);
      const idx=pilih?parseInt(pilih.dataset.value):-1;
      const isBenar=idx===s.jawaban;
      if(isBenar) benar++;
      hasil+=`<p><strong>${i+1}.</strong> ${isBenar?'‚úÖ Benar':'‚ùå Salah'}</p><div class="pembahasan">${s.pembahasan}</div>`;
    });
    const skor=Math.round((benar/SOAL[pelajaran].length)*100);
    document.getElementById('hasilTes').innerHTML=`<div class="scoreBox">üìä Nilai Akhir: ${skor}</div>${hasil}`;
    document.getElementById('hasilTes').classList.remove('hidden');
  };
}

// ===== Admin Functions =====
function tampilTabelAdmin(){
  const tbody=document.querySelector('#tabelVerifikasi tbody'); tbody.innerHTML="";
  Object.keys(USERS).filter(e=>"admin@gmail.com"!==e).forEach(email=>{
    const data=VERIFIKASI[email]||{status:"Belum"};
    let aksi=data.status==="Disetujui"?`Disetujui`:`<button onclick="verifikasiUser('${email}')">Setujui</button>`;
    const row=document.createElement('tr');
    row.innerHTML=`<td>${email}</td><td>${data.status}</td><td>${aksi}</td>`;
    tbody.appendChild(row);
  });
}
function verifikasiUser(email){ VERIFIKASI[email]={status:"Disetujui",verifiedAt:new Date().toISOString()}; localStorage.setItem('verifikasiData',JSON.stringify(VERIFIKASI)); tampilTabelAdmin(); alert(`${email} diverifikasi.`); }
</script>
</body>
</html>
